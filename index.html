<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Laboratory Usage System</title>
<link rel="icon" type="image/png" href="gs.jfif">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* YOUR ORIGINAL STYLES REMAIN UNCHANGED */
/* ... keep all your CSS from your previous code unchanged ... */
</style>
</head>
<body>
<header>
  <div class="header-container">
    <img src="gs.jfif" class="gsc-logo" alt="GSC logo">
    <div class="header-text">
      <h1>Good Samaritan Colleges</h1>
      <p>Laboratory Usage System</p>
    </div>
  </div>
</header>

<nav>
  <div id="tab-logbook" class="tab active">Logbook</div>
  <div id="tab-reports" class="tab">Reports</div>
  <div id="tab-chemicals" class="tab">Chemicals</div>
</nav>

<main>
  <!-- LOGBOOK -->
  <section id="view-logbook">
    <!-- YOUR LOGBOOK HTML REMAINS UNCHANGED -->
  </section>

  <!-- REPORTS -->
  <section id="view-reports" style="display:none;">
    <!-- YOUR REPORTS HTML REMAINS UNCHANGED -->
  </section>

  <!-- CHEMICALS INVENTORY -->
  <section id="view-chemicals" style="display:none;">
    <div class="card">
      <h2 style="margin:0 0 10px;color:var(--gsc-blue)">Chemicals Inventory</h2>
      <div class="controls">
        <input id="searchChemicalInput" class="search-input" placeholder="Search reagents/chemicals..." />
        <button id="refreshChemicalsBtn" class="secondary">Refresh</button>
      </div>
      <div class="table-wrap card" style="padding:0">
        <table id="chemicalsTable">
          <thead>
            <tr>
              <th>Chemical</th>
              <th>Hazard</th>
              <th>Date Opened</th>
              <th>Expiry/Retest Date</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
</main>

<footer>
  © 2025 Good Samaritan Colleges | Faculty Laboratory eLog System — Improved<br>
  Prepared by Piolo L. Bernardino — Laboratory Custodian
</footer>

<div id="toast" class="toast"></div>

<script>
// ========== YOUR ORIGINAL JS (LOGBOOK + REPORTS) REMAINS UNCHANGED ==========
/* Paste all your previous JavaScript here exactly as-is */
/* ... all your form, table, charts, export, search, tabs, etc. ... */

// ====================== CHEMICALS TAB SCRIPT ======================
const CHEMICALS_SHEET_ID = "11ktnDlnAgnaasZe9tfAkV6_zNG2oHCm_3EGZIVotQ7Y"; // your sheet
const CHEMICALS_SHEET_NAME = "Sheet1"; // adjust if needed
const chemicalsTableBody = document.querySelector('#chemicalsTable tbody');
const searchChemicalInput = document.getElementById('searchChemicalInput');
const refreshChemicalsBtn = document.getElementById('refreshChemicalsBtn');
const viewChemicals = document.getElementById('view-chemicals');
const tabChemicals = document.getElementById('tab-chemicals');

let chemicalsList = [];

async function fetchChemicals() {
  try {
    const url = `https://docs.google.com/spreadsheets/d/${CHEMICALS_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(CHEMICALS_SHEET_NAME)}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Failed to fetch chemicals');
    const text = await res.text();
    const rows = text.trim().split('\n').map(r => r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
    rows.shift(); // remove header
    chemicalsList = rows.map(r => ({
      chemical: r[0] || '',
      hazard: r[1] || '',
      date_opened: r[2] || '',
      expiry: r[3] || '',
      remarks: r[4] || ''
    }));
    renderChemicalsTable();
    showToast('✅ Chemicals loaded');
  } catch(err) {
    console.error(err);
    showToast('⚠️ Could not load chemicals');
  }
}

function renderChemicalsTable() {
  const q = (searchChemicalInput.value || '').toLowerCase().trim();
  chemicalsTableBody.innerHTML = '';
  chemicalsList
    .filter(c => !q || Object.values(c).some(v => v.toLowerCase().includes(q)))
    .forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(c.chemical)}</td>
        <td>${escapeHtml(c.hazard)}</td>
        <td>${escapeHtml(c.date_opened)}</td>
        <td>${escapeHtml(c.expiry)}</td>
        <td>${escapeHtml(c.remarks)}</td>
      `;
      chemicalsTableBody.appendChild(tr);
    });
}

// EVENTS
searchChemicalInput.addEventListener('input', renderChemicalsTable);
refreshChemicalsBtn.addEventListener('click', fetchChemicals);

// TAB SWITCHING
tabChemicals.onclick = () => {
  tabChemicals.classList.add('active');
  tabLog.classList.remove('active');
  tabReports.classList.remove('active');
  viewChemicals.style.display = '';
  viewLog.style.display = 'none';
  viewReports.style.display = 'none';
  fetchChemicals();
};
</script>
</body>
</html>
