<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Laboratory Usage System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{--gsc-blue:#1e3a8a;--gsc-accent:#2563eb;--gsc-bg:#f1f5f9}
  body{font-family:Segoe UI,Arial,sans-serif;margin:0;background:var(--gsc-bg);color:#222}
  header{background:white;color:var(--gsc-blue);padding:15px 20px;box-shadow:0 4px 10px rgba(0,0,0,.08);border-bottom:4px solid var(--gsc-blue)}
  .header-container{display:flex;align-items:center;gap:18px;max-width:1100px;margin:0 auto}
  .gsc-logo{width:100px;height:auto}
  .header-text h1{margin:0;font-size:22px;color:var(--gsc-blue)}
  .header-text p{margin:4px 0 0;font-size:14px;color:var(--gsc-accent);font-weight:500}
  nav{max-width:1100px;margin:16px auto 0;padding:0 20px;display:flex;gap:10px}
  .tab{background:white;padding:10px 16px;border-radius:8px;border:1px solid #e6eefc;cursor:pointer;font-weight:600;color:var(--gsc-blue)}
  .tab.active{background:linear-gradient(90deg,var(--gsc-blue),var(--gsc-accent));color:white;border-color:transparent}
  main{max-width:1100px;margin:18px auto;padding:0 20px 40px}
  .card{background:white;border-radius:12px;padding:18px;box-shadow:0 6px 16px rgba(15,23,42,.04);margin-bottom:18px}
  input,textarea,select,button{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ced4da;border-radius:6px;font-size:14px}
  /* Label color fix */
label {
  font-weight:600;
  font-size:13px;
  color:var(--gsc-blue);
  display:block;
  margin-bottom:4px;
}

  button.primary{background:var(--gsc-accent);color:white;border:none;cursor:pointer;font-weight:700}
  button.secondary{background:#fff;border:1px solid #ddd;color:#333;cursor:pointer}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row .col{flex:1;min-width:150px}
  .controls{display:flex;gap:10px;justify-content:flex-end;margin-bottom:12px;flex-wrap:wrap}
  table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 6px 16px rgba(15,23,42,.04)}
  th,td{padding:10px;border:1px solid #e6eefc;text-align:left;font-size:13px;white-space:nowrap}
  th{background:var(--gsc-blue);color:white;font-weight:700}
  tr:nth-child(even) td{background:#fbfdff}
  .list-area{width:260px;max-height:220px;overflow:auto;padding:6px 8px;border-left:1px solid #eef4ff}
  .list-item{display:flex;justify-content:space-between;padding:6px 4px;border-bottom:1px dashed #f1f6ff;font-size:13px}
  footer{max-width:1100px;margin:22px auto;padding:18px 20px;color:#555;font-size:13px;text-align:center}
  .toast{position:fixed;right:18px;bottom:18px;background:rgba(37,99,235,.95);color:white;padding:10px 14px;border-radius:8px;box-shadow:0 6px 18px rgba(15,23,42,.2);z-index:9999;font-weight:600;display:none}
  @media (min-width:900px){ .reports-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px} }
  @media (min-width:1200px){ .reports-grid{grid-template-columns:1fr 1fr 1fr} }
  .card table{display:block;width:100%;overflow-x:auto}
  #elogTable{table-layout:auto}
  @media print { nav, .controls, form, footer, .toast { display:none !important; } .reports-print{ display:block !important; } }
  /* Make "Log in Form" title blue only */
form h2 {
  color: var(--gsc-blue) !important;
}

</style>
</head>
<body>
  <header>
    <div class="header-container">
      <img src="gs.jfif" class="gsc-logo" alt="GSC logo">
      <div class="header-text">
        <h1>Good Samaritan Colleges</h1>
        <p>Faculty Laboratory Usage System</p>
      </div>
    </div>
  </header>

  <nav>
    <div id="tab-logbook" class="tab active">Logbook</div>
    <div id="tab-reports" class="tab">Reports</div>
  </nav>

  <main>
    <!-- LOGBOOK -->
    <section id="view-logbook">
      <div class="card">
        <form id="elogForm">
          <h2>Log in Form</h2>

          <div class="row">
            <div class="col">
              <label>Faculty Name</label>
              <input id="faculty_name" placeholder="Ex. Juan Dela Cruz" required>
            </div>
            <div class="col">
              <label>Department</label>
              <input id="department" placeholder="Ex. CNAM" required>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Laboratory Room Name</label>
              <input id="room_name" placeholder="Ex. Chemistry Room" required>
            </div>
            <div class="col">
              <label>Room Number (Required)</label>
              <input id="room_number" placeholder="Ex. 301">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Major Equipment Used</label>
              <input id="equipment" placeholder="Ex. Microscope-1">
            </div>
            <div class="col">
              <label>Date Requested</label>
              <input type="date" id="date" readonly>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Time-In</label>
              <input type="time" id="time_in" required>
            </div>
            <div class="col">
              <label>Time-Out</label>
              <input type="time" id="time_out" required>
            </div>
          </div>

          <label>Purpose / Activity</label>
          <input id="purpose" placeholder="Ex. Experiment on solutions" required>

          <label>Remarks (Optional)</label>
          <textarea id="remarks" rows="2" placeholder="Remarks"></textarea>

          <div style="display:flex;gap:10px;justify-content:center;">
            <button class="primary" type="submit">Add Log</button>
            <button class="secondary" id="clearFormBtn" type="button">Clear</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="controls">
          <button id="exportCsvBtn" class="secondary">Export Logs (CSV)</button>
          <button id="printLogsBtn" class="secondary">Print Logs</button>
        </div>

        <table id="elogTable">
          <thead>
            <tr>
              <th>Timestamp</th><th>Faculty Name</th><th>Department</th><th>Room Name</th><th>Room #</th>
              <th>Equipment</th><th>Date</th><th>Time In</th><th>Time Out</th><th>Purpose</th><th>Remarks</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- REPORTS -->
    <section id="view-reports" style="display:none;">
      <div class="card" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
        <div>
          <h2 style="margin:0;color:var(--gsc-blue)">Faculty Laboratory Usage Report</h2>
          <div style="margin-top:6px;color:#444">Generated: <span id="reportDatePretty"></span></div>
        </div>
        <button id="printReportsBtn" class="primary">Print Reports</button>
      </div>

      <div class="reports-grid" style="margin-top:12px">
        <div class="report-card card"><canvas id="chartRooms"></canvas><div class="list-area"><strong>Rooms</strong><div id="listRooms"></div></div></div>
        <div class="report-card card"><canvas id="chartEquipment"></canvas><div class="list-area"><strong>Equipment</strong><div id="listEquipment"></div></div></div>
        <div class="report-card card"><canvas id="chartFaculty"></canvas><div class="list-area"><strong>Faculty</strong><div id="listFaculty"></div></div></div>
      </div>
    </section>
  </main>

  <footer>
    ¬© 2025 Good Samaritan Colleges | Faculty Laboratory eLog System<br>
    Prepared by Piolo L. Bernardino ‚Äî Laboratory Custodian
  </footer>

  <div id="toast" class="toast"></div>

<script>
/* ---------- GOOGLE FORM CONFIG ---------- */
const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSdPZLGabjI36s4iFdU-grRUK0ouLvoYrkV391MLxPrRWdZiHQ/formResponse";
const FORM_ENTRY = {
  faculty_name:"entry.694323400",department:"entry.1656788187",room_name:"entry.1132289973",
  room_number:"entry.19898501",equipment:"entry.743283452",date:"entry.1998901142",
  time_in:"entry.736543893",time_out:"entry.1466121044",purpose:"entry.589165766",remarks:"entry.1595227859"
};
/* ---------- BASE FUNCTIONS ---------- */
const form=document.getElementById('elogForm');
const tableBody=document.querySelector('#elogTable tbody');
const exportCsvBtn=document.getElementById('exportCsvBtn');
const printLogsBtn=document.getElementById('printLogsBtn');
const printReportsBtn=document.getElementById('printReportsBtn');
const toastEl=document.getElementById('toast');
const tabLog=document.getElementById('tab-logbook');
const tabReports=document.getElementById('tab-reports');
const viewLog=document.getElementById('view-logbook');
const viewReports=document.getElementById('view-reports');
let logs=JSON.parse(localStorage.getItem('facultyLogs'))||[];

function makeId(){return Date.now()+Math.floor(Math.random()*1000);}
function showToast(msg,duration=2500){toastEl.textContent=msg;toastEl.style.display='block';setTimeout(()=>toastEl.style.display='none',duration);}
function escapeHtml(s){return s?String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])):'';}

function renderTable(){
  tableBody.innerHTML='';
  logs.forEach(item=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${new Date(item.created_at).toLocaleString()}</td>
      <td>${escapeHtml(item.faculty_name)}</td>
      <td>${escapeHtml(item.department)}</td>
      <td>${escapeHtml(item.room_name)}</td>
      <td>${escapeHtml(item.room_number)}</td>
      <td>${escapeHtml(item.equipment)}</td>
      <td>${escapeHtml(item.date)}</td>
      <td>${escapeHtml(item.time_in)}</td>
      <td>${escapeHtml(item.time_out)}</td>
      <td>${escapeHtml(item.purpose)}</td>
      <td>${escapeHtml(item.remarks)}</td>
      <td><button class="secondary" onclick="deleteLog(${item._id})">Delete</button></td>`;
    tableBody.appendChild(tr);
  });
  localStorage.setItem('facultyLogs',JSON.stringify(logs));
  updateReports();
}

function setDateTimeNowToForm(){
  const now=new Date();
  document.getElementById('date').value=now.toISOString().split('T')[0];
  const hh=String(now.getHours()).padStart(2,'0'),mm=String(now.getMinutes()).padStart(2,'0');
  document.getElementById('time_in').value=`${hh}:${mm}`;
}

async function uploadToGoogleForm(obj){
  try{
    const fd=new FormData();
    for(const k in FORM_ENTRY)fd.append(FORM_ENTRY[k],obj[k]||'');
    await fetch(GOOGLE_FORM_ACTION,{method:'POST',mode:'no-cors',body:fd});
    showToast('‚úÖ Synced to Google Sheets (via Form)');
  }catch{showToast('‚ö†Ô∏è Saved locally ‚Äî form sync failed');}
}

/* ---------- FORM ---------- */
form.addEventListener('submit',async e=>{
  e.preventDefault();
  const now=Date.now();
  const newItem={
    _id:makeId(),created_at:now,
    faculty_name:faculty_name.value.trim(),department:department.value.trim(),
    room_name:room_name.value.trim(),room_number:room_number.value.trim(),
    equipment:equipment.value.trim(),date:date.value,time_in:time_in.value,
    time_out:time_out.value,purpose:purpose.value.trim(),remarks:remarks.value.trim()
  };
  logs.push(newItem);renderTable();form.reset();setDateTimeNowToForm();
  uploadToGoogleForm(newItem);
});
clearFormBtn.onclick=()=>{form.reset();setDateTimeNowToForm();};
window.deleteLog=id=>{if(confirm('Delete this entry?')){logs=logs.filter(x=>x._id!==id);renderTable();showToast('üóëÔ∏è Entry deleted');}};
exportCsvBtn.onclick=()=>{if(!logs.length)return showToast('‚ö†Ô∏è No logs');const h=['Timestamp','Faculty','Dept','Room','Room#','Equip','Date','In','Out','Purpose','Remarks'];const rows=logs.map(r=>[new Date(r.created_at).toLocaleString(),r.faculty_name,r.department,r.room_name,r.room_number,r.equipment,r.date,r.time_in,r.time_out,r.purpose,r.remarks]);const csv=[h,...rows].map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='faculty_logs.csv';a.click();};
printLogsBtn.onclick=()=>window.print();
printReportsBtn.onclick=()=>{tabReports.click();setTimeout(()=>window.print(),300);}
tabLog.onclick=()=>{tabLog.classList.add('active');tabReports.classList.remove('active');viewLog.style.display='';viewReports.style.display='none';};
tabReports.onclick=()=>{tabReports.classList.add('active');tabLog.classList.remove('active');viewReports.style.display='';viewLog.style.display='none';fetchFromSheet();};

/* ---------- REPORTS ---------- */
function computeCounts(){const rooms={},eq={},fac={};logs.forEach(l=>{rooms[l.room_name]=(rooms[l.room_name]||0)+1;eq[l.equipment]=(eq[l.equipment]||0)+1;fac[l.faculty_name]=(fac[l.faculty_name]||0)+1;});return{rooms:eqEmpty(rooms),equipment:eqEmpty(eq),faculty:eqEmpty(fac)};}
function eqEmpty(o){return Object.keys(o).length?o:{'No data':0};}
function populateList(c,o){c.innerHTML='';Object.entries(o).sort((a,b)=>b[1]-a[1]).forEach(([k,v])=>{c.innerHTML+=`<div class="list-item"><div>${k}</div><div>${v}</div></div>`});}
let chartRooms,chartEquipment,chartFaculty;
function updateChart(id,obj,inst){const ctx=document.getElementById(id).getContext('2d');const l=Object.keys(obj),d=Object.values(obj);if(inst){inst.data.labels=l;inst.data.datasets[0].data=d;inst.update();return inst;}return new Chart(ctx,{type:'bar',data:{labels:l,datasets:[{data:d,backgroundColor:l.map(()=> 'rgba(37,99,235,0.75)')}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});}
function updateReports(){document.getElementById('reportDatePretty').textContent=new Date().toLocaleString();const c=computeCounts();populateList(listRooms,c.rooms);populateList(listEquipment,c.equipment);populateList(listFaculty,c.faculty);chartRooms=updateChart('chartRooms',c.rooms,chartRooms);chartEquipment=updateChart('chartEquipment',c.equipment,chartEquipment);chartFaculty=updateChart('chartFaculty',c.faculty,chartFaculty);}

/* ---------- LIVE REPORT FETCH ---------- */
const SHEET_ID="1BFmqX4hjDp73GpYzFZFTwx22l-l5WtbU4UPh2ncr4hs"; // your sheet ID
const SHEET_NAME="Form Responses 1";
async function fetchFromSheet(){
  try{
    const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
    const res=await fetch(url);
    if(!res.ok)throw new Error("Failed");
    const text=await res.text();
    const rows=text.trim().split("\n").map(r=>r.split(","));
    rows.shift(); // remove headers
    logs=rows.map(r=>({_id:makeId(),created_at:Date.now(),faculty_name:r[1],department:r[2],room_name:r[3],room_number:r[4],equipment:r[5],date:r[6],time_in:r[7],time_out:r[8],purpose:r[9],remarks:r[10]}));
    renderTable();
    showToast("üìä Live data loaded from Google Sheets");
  }catch(err){console.error(err);showToast("‚ö†Ô∏è Could not load live data");}
}

/* ---------- INIT ---------- */
setDateTimeNowToForm();
renderTable();
</script>
</body>
</html>





