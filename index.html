<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Faculty Laboratory eLog — Good Samaritan Colleges</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{--gsc-blue:#1e3a8a;--gsc-accent:#2563eb;--gsc-bg:#f1f5f9}
  body{font-family:Segoe UI,Arial,sans-serif;margin:0;background:var(--gsc-bg);color:#222}
  header{background:white;color:var(--gsc-blue);padding:15px 20px;box-shadow:0 4px 10px rgba(0,0,0,.08);border-bottom:4px solid var(--gsc-blue)}
  .header-container{display:flex;align-items:center;gap:18px;max-width:1100px;margin:0 auto}
  .gsc-logo{width:100px;height:auto}
  .header-text h1{margin:0;font-size:22px;color:var(--gsc-blue)}
  .header-text p{margin:4px 0 0;font-size:14px;color:var(--gsc-accent);font-weight:500}
  nav{max-width:1100px;margin:16px auto 0;padding:0 20px;display:flex;gap:10px}
  .tab{background:white;padding:10px 16px;border-radius:8px;border:1px solid #e6eefc;cursor:pointer;font-weight:600;color:var(--gsc-blue)}
  .tab.active{background:linear-gradient(90deg,var(--gsc-blue),var(--gsc-accent));color:white;border-color:transparent}
  main{max-width:1100px;margin:18px auto;padding:0 20px 40px}
  .card{background:white;border-radius:12px;padding:18px;box-shadow:0 6px 16px rgba(15,23,42,.04);margin-bottom:18px}
  form h2{margin:0 0 12px 0;text-align:center;color:var(--gsc-blue)}
  input,textarea,select,button{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ced4da;border-radius:6px;font-size:14px}
  input:focus,textarea:focus{outline:none;border-color:var(--gsc-accent);box-shadow:0 0 6px rgba(37,99,235,.15)}
  button.primary{background:var(--gsc-accent);color:white;border:none;cursor:pointer;font-weight:700}
  button.secondary{background:#fff;border:1px solid #ddd;color:#333;cursor:pointer}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row .col{flex:1;min-width:150px}
  .controls{display:flex;gap:10px;justify-content:flex-end;margin-bottom:12px;flex-wrap:wrap}
  table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 6px 16px rgba(15,23,42,.04)}
  th,td{padding:10px;border:1px solid #e6eefc;text-align:left;font-size:13px;white-space:nowrap}
  th{background:var(--gsc-blue);color:white;font-weight:700}
  tr:nth-child(even) td{background:#fbfdff}
  .list-area{width:260px;max-height:220px;overflow:auto;padding:6px 8px;border-left:1px solid #eef4ff}
  .list-item{display:flex;justify-content:space-between;padding:6px 4px;border-bottom:1px dashed #f1f6ff;font-size:13px}
  footer{max-width:1100px;margin:22px auto;padding:18px 20px;color:#555;font-size:13px;text-align:center}
  .toast{position:fixed;right:18px;bottom:18px;background:rgba(37,99,235,.95);color:white;padding:10px 14px;border-radius:8px;box-shadow:0 6px 18px rgba(15,23,42,.2);z-index:9999;font-weight:600;display:none}
  @media (min-width:900px){ .reports-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px} }
  @media (min-width:1200px){ .reports-grid{grid-template-columns:1fr 1fr 1fr} }
  .card table{display:block;width:100%;overflow-x:auto}
  #elogTable{table-layout:auto}
</style>
</head>
<body>
  <header>
    <div class="header-container">
      <img src="gs.jfif" class="gsc-logo" alt="GSC logo">
      <div class="header-text">
        <h1>Good Samaritan Colleges</h1>
        <p>Faculty Laboratory eLog System</p>
      </div>
    </div>
  </header>

  <nav>
    <div id="tab-logbook" class="tab active">Logbook</div>
    <div id="tab-reports" class="tab">Reports</div>
  </nav>

  <main>
    <!-- LOGBOOK -->
    <section id="view-logbook">
      <div class="card">
        <form id="elogForm">
          <h2>Add Faculty Log</h2>

          <div class="row">
            <div class="col"><input id="log_id" placeholder="Log ID (auto)" readonly></div>
            <div class="col"><input id="faculty_name" placeholder="Faculty Name" required></div>
          </div>

          <div class="row">
            <div class="col"><input id="department" placeholder="Department" required></div>
            <div class="col"><input id="room_name" placeholder="Laboratory Room Name" required></div>
          </div>

          <div class="row">
            <div class="col"><input id="room_number" placeholder="Room Number (optional)"></div>
            <div class="col"><input id="equipment" placeholder="Special / Major Equipment Used (optional)"></div>
          </div>

          <div class="row">
            <div class="col"><input type="date" id="date" readonly></div>
            <div class="col"><input type="time" id="time_in" required></div>
            <div class="col"><input type="time" id="time_out" required></div>
          </div>

          <input id="purpose" placeholder="Purpose / Activity" required>
          <textarea id="remarks" rows="2" placeholder="Remarks (optional)"></textarea>

          <div style="display:flex;gap:10px;justify-content:center;">
            <button class="primary" type="submit">Add Log</button>
            <button class="secondary" id="clearFormBtn" type="button">Clear</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="controls">
          <button id="exportCsvBtn" class="secondary">Export All Logs (CSV)</button>
          <button id="printLogsBtn" class="secondary">Print Logs</button>
        </div>

        <table id="elogTable">
          <thead>
            <tr>
              <th>Log ID</th><th>Faculty Name</th><th>Department</th><th>Room Name</th><th>Room #</th>
              <th>Equipment</th><th>Date</th><th>Time In</th><th>Time Out</th><th>Purpose</th><th>Remarks</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- REPORTS -->
    <section id="view-reports" style="display:none;">
      <div class="card" style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
        <div>
          <h2 style="margin:0;color:var(--gsc-blue)">Faculty Laboratory Usage Report — Good Samaritan Colleges</h2>
          <div style="margin-top:6px;color:#444">Generated: <span id="reportDatePretty"></span></div>
        </div>
      </div>

      <div class="reports-grid" style="margin-top:12px">
        <div class="report-card card report-rooms">
          <div style="flex:1;min-height:220px"><canvas id="chartRooms"></canvas></div>
          <div class="list-area">
            <strong>Rooms (counts)</strong>
            <div id="listRooms"></div>
          </div>
        </div>

        <div class="report-card card report-equipment">
          <div style="flex:1;min-height:220px"><canvas id="chartEquipment"></canvas></div>
          <div class="list-area">
            <strong>Equipment (counts)</strong>
            <div id="listEquipment"></div>
          </div>
        </div>

        <div class="report-card card report-faculty">
          <div style="flex:1;min-height:220px"><canvas id="chartFaculty"></canvas></div>
          <div class="list-area">
            <strong>Faculty (counts)</strong>
            <div id="listFaculty"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    © 2025 Good Samaritan Colleges | Faculty Laboratory eLog System<br>
    Prepared by Piolo L. Bernardino — Laboratory Custodian
  </footer>

  <div id="toast" class="toast"></div>

<script>
/* --- FORM CONFIG (from your prefilled link) --- */
const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSdPZLGabjI36s4iFdU-grRUK0ouLvoYrkV391MLxPrRWdZiHQ/formResponse";

const FORM_ENTRY = {
  log_id:        "entry.162082453",
  faculty_name:  "entry.694323400",
  department:    "entry.1656788187",
  room_name:     "entry.1132289973",
  room_number:   "entry.19898501",
  equipment:     "entry.743283452",
  // note: your prefilled link included entry.1681654886 but there was no matching field name in our app;
  // if you want that saved, tell me the question name and I will add it.
  date:          "entry.1998901142",
  time_in:       "entry.736543893",
  time_out:      "entry.1466121044",
  purpose:       "entry.589165766",
  remarks:       "entry.1595227859"
};
/* --- end config --- */

const form = document.getElementById('elogForm');
const tableBody = document.querySelector('#elogTable tbody');
const exportCsvBtn = document.getElementById('exportCsvBtn');
const printLogsBtn = document.getElementById('printLogsBtn');
const toastEl = document.getElementById('toast');
const tabLog = document.getElementById('tab-logbook');
const tabReports = document.getElementById('tab-reports');
const viewLog = document.getElementById('view-logbook');
const viewReports = document.getElementById('view-reports');

let logs = JSON.parse(localStorage.getItem('facultyLogs')) || [];
let logCounter = logs.length ? (Math.max(...logs.map(l=>l.log_id||0))+1) : 1;

function showToast(msg, duration=3000){
  toastEl.textContent = msg;
  toastEl.style.display='block';
  setTimeout(()=> toastEl.style.display='none', duration);
}

function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

function renderTable(){
  tableBody.innerHTML = '';
  logs.forEach(log=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${log.log_id}</td>
      <td>${escapeHtml(log.faculty_name)}</td>
      <td>${escapeHtml(log.department)}</td>
      <td>${escapeHtml(log.room_name)}</td>
      <td>${escapeHtml(log.room_number)}</td>
      <td>${escapeHtml(log.equipment)}</td>
      <td>${escapeHtml(log.date)}</td>
      <td>${escapeHtml(log.time_in)}</td>
      <td>${escapeHtml(log.time_out)}</td>
      <td>${escapeHtml(log.purpose)}</td>
      <td>${escapeHtml(log.remarks)}</td>
      <td class="actions"><button class="secondary" onclick="deleteLog(${log.log_id})">Delete</button></td>
    `;
    tableBody.appendChild(tr);
  });
  localStorage.setItem('facultyLogs', JSON.stringify(logs));
  updateReports();
}

function setDateTimeNowToForm(){
  const now = new Date();
  document.getElementById('date').value = now.toISOString().split('T')[0];
  document.getElementById('log_id').value = logCounter;
}

async function uploadToGoogleForm(newLog){
  if (!GOOGLE_FORM_ACTION.includes('1FAIpQLS')) return;
  try{
    const fd = new FormData();
    for (const k in FORM_ENTRY){
      const eid = FORM_ENTRY[k];
      if (!eid) continue;
      fd.append(eid, newLog[k] || '');
    }
    // no-cors POST to Google Forms
    await fetch(GOOGLE_FORM_ACTION, { method:'POST', mode:'no-cors', body: fd });
    showToast('✅ Log synced to Google Sheets (via Form)');
  } catch(err){
    console.error('uploadToGoogleForm error', err);
    showToast('⚠️ Saved locally — form sync failed');
  }
}

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const newLog = {
    log_id: logCounter++,
    faculty_name: document.getElementById('faculty_name').value.trim(),
    department: document.getElementById('department').value.trim(),
    room_name: document.getElementById('room_name').value.trim(),
    room_number: document.getElementById('room_number').value.trim(),
    equipment: document.getElementById('equipment').value.trim(),
    date: document.getElementById('date').value,
    time_in: document.getElementById('time_in').value,
    time_out: document.getElementById('time_out').value,
    purpose: document.getElementById('purpose').value.trim(),
    remarks: document.getElementById('remarks').value.trim()
  };

  // save locally and render
  logs.push(newLog);
  renderTable();
  form.reset();
  setDateTimeNowToForm();

  // upload to Google Form (no-cors)
  uploadToGoogleForm(newLog);
});

document.getElementById('clearFormBtn').addEventListener('click', ()=>{
  form.reset();
  setDateTimeNowToForm();
});

window.deleteLog = function(id){
  if (!confirm('Delete this entry?')) return;
  logs = logs.filter(l=>l.log_id !== id);
  renderTable();
};

// export CSV
exportCsvBtn.addEventListener('click', ()=>{
  if (!logs.length){ showToast('⚠️ No logs to export'); return; }
  const headers = ['Log ID','Faculty Name','Department','Room Name','Room #','Equipment Used','Date','Time In','Time Out','Purpose','Remarks'];
  const rows = logs.map(l=>[
    l.log_id,l.faculty_name,l.department,l.room_name,l.room_number,l.equipment,l.date,l.time_in,l.time_out,l.purpose,l.remarks
  ]);
  const csv = [headers].concat(rows).map(r => r.map(cell=>`"${String(cell||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], { type:'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=`faculty_elog_export_${(new Date()).toISOString().slice(0,10)}.csv`; a.click();
  URL.revokeObjectURL(url);
  showToast('✅ Logs exported as CSV');
});

// print
printLogsBtn.addEventListener('click', ()=>{ window.print(); });

// tabs
tabLog.addEventListener('click', ()=>{ tabLog.classList.add('active'); tabReports.classList.remove('active'); viewLog.style.display=''; viewReports.style.display='none'; });
tabReports.addEventListener('click', ()=>{ tabReports.classList.add('active'); tabLog.classList.remove('active'); viewReports.style.display=''; viewLog.style.display='none'; updateReports(); });

// reports
function computeCounts(){
  const rooms={}, equipment={}, faculty={};
  logs.forEach(l=>{
    const r=(l.room_name||'(No room)').trim(); rooms[r]=(rooms[r]||0)+1;
    const e=(l.equipment||'(No equipment)').trim(); equipment[e]=(equipment[e]||0)+1;
    const f=(l.faculty_name||'(No name)').trim(); faculty[f]=(faculty[f]||0)+1;
  });
  return { rooms, equipment, faculty };
}

function populateList(container, obj){
  container.innerHTML='';
  const entries = Object.entries(obj).sort((a,b)=>b[1]-a[1]);
  if(!entries.length){ container.innerHTML='<div style="color:#666;padding:6px">No entries</div>'; return; }
  entries.forEach(([k,v])=>{ const div=document.createElement('div'); div.className='list-item'; div.innerHTML=`<div>${k}</div><div>${v}</div>`; container.appendChild(div); });
}

let chartRooms, chartEquipment, chartFaculty;
function updateChart(canvasId, obj, instance){
  const labels = Object.keys(obj);
  const data = Object.values(obj);
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (instance){ instance.data.labels = labels; instance.data.datasets[0].data = data; instance.update(); return instance; }
  return new Chart(ctx, { type:'bar', data: { labels, datasets:[{ data, backgroundColor: labels.map(()=> 'rgba(37,99,235,0.75)') }] }, options:{ plugins:{legend:{display:false}}, scales:{ y:{ beginAtZero:true } } } });
}

function updateReports(){
  document.getElementById('reportDatePretty').textContent = new Date().toLocaleString();
  const counts = computeCounts();
  populateList(document.getElementById('listRooms'), counts.rooms);
  populateList(document.getElementById('listEquipment'), counts.equipment);
  populateList(document.getElementById('listFaculty'), counts.faculty);
  chartRooms = updateChart('chartRooms', counts.rooms, chartRooms);
  chartEquipment = updateChart('chartEquipment', counts.equipment, chartEquipment);
  chartFaculty = updateChart('chartFaculty', counts.faculty, chartFaculty);
}

// init
setDateTimeNowToForm();
renderTable();
window.addEventListener('focus', ()=>{ if(chartRooms) chartRooms.resize(); if(chartEquipment) chartEquipment.resize(); if(chartFaculty) chartFaculty.resize(); });
</script>
</body>
</html>
